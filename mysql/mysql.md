# mysql
[toc]

### 技巧总结
1. 不要使用select *
2. 一定要加limit,
3. * and:并且
    * or:或者
    * and条件优先组合（优先级高）
    * 然后再考虑or
4. count(*)统计数据库条数，与是否null无关
    count(值)统计非空条数
5. 分组函数一定在group by之后执行，并且一半连用，这就是为啥叫分组函数
6. 当有group by时，select后只能跟分组函数和参与分组的字段

### 更换并查看使用哪个数据库
```sql
mysql> use 管信2;
Database changed

mysql> select database();
+------------+
| database() |
+------------+
| 管信2      |
+------------+
1 row in set (0.00 sec)
```

### 查看建表语句

```sql
show create table 管信2.学生信息表;


学生信息表
CREATE TABLE `学生信息表` ( 
    `学号` varchar(10) NOT NULL, 
    `姓名` varchar(10) NOT NULL, 
    `性别` varchar(2) DEFAULT NULL, 
    `出生日期` datetime DEFAULT NULL, 
    `政治面貌` varchar(10) DEFAULT NULL, 
    `班级` varchar(6) DEFAULT NULL, 
    `毕业学校` varchar(20) DEFAULT NULL, 
    PRIMARY KEY (`学号`) ) 
    ENGINE=InnoDB DEFAULT 
    CHARSET=utf8mb4 
    COLLATE=utf8mb4_0900_ai_ci
```

### 简单查询
```sql
select
    ...
from 
    ...
where
    ...
group by 
    ...
having
    ...
order by
    ...
limit
    ...;
```

黑框框里一定要打limit。。。

不区分大小写
```sql
mysql> select 姓名 from 学生信息表 limit 10;
+------------+
| 姓名       |
+------------+
| 申X牟      |
| 汲X商      |
| 宫X苏      |
| 祖X贾      |
| 皇甫X邴    |
| 须X上官    |
| 郗X姜      |
| 夹谷X贺    |
| 张X仲孙    |
| 暨X梁丘    |
+------------+
10 rows in set (0.00 sec)

mysql> select * from 学生信息表 limit 10;
+----------+------------+--------+---------------------+--------------+--------+--------------+
| 学号     | 姓名       | 性别   | 出生日期            | 政治面貌     | 班级   | 毕业学校     |
+----------+------------+--------+---------------------+--------------+--------+--------------+
| 19980101 | 申X牟      | 女     | 1998-05-01 00:00:00 | 团员         | 9801   | 10           |
| 19980102 | 汲X商      | 女     | 1998-12-01 00:00:00 | 团员         | 9801   | 66           |
| 19980103 | 宫X苏      | 女     | 1998-09-22 00:00:00 | 群众         | 9801   | 83           |
| 19980104 | 祖X贾      | 女     | 1998-03-01 00:00:00 | 团员         | 9801   | 66           |
| 19980105 | 皇甫X邴    | 男     | 1998-06-28 00:00:00 | 群众         | 9801   | 50           |
| 19980106 | 须X上官    | 女     | 1998-02-17 00:00:00 | 团员         | 9801   | 20           |
| 19980107 | 郗X姜      | 女     | 1998-03-01 00:00:00 | 群众         | 9801   | 39           |
| 19980108 | 夹谷X贺    | 女     | 1998-12-01 00:00:00 | 团员         | 9801   | 17           |
| 19980109 | 张X仲孙    | 男     | 1998-08-01 00:00:00 | 群众         | 9801   | 48           |
| 19980110 | 暨X梁丘    | 男     | 1998-02-09 00:00:00 | 团员         | 9801   | 74           |
+----------+------------+--------+---------------------+--------------+--------+--------------+
10 rows in set (0.00 sec)


```
#### 实现值得转换（男女转换为 0,1）
使用
CASE '栏' WHEN '值1' THEN '更改值' WHEN '值2' THEN '更改值2' ELSE '更改值3' END AS '新栏'

```sql
select 姓名,
CASE 性别 
WHEN '男' THEN '1' 
WHEN '女' THEN '2' 
ELSE '3' END 
AS 性别 
from 学生信息表 limit 10;

+------------+--------+
| 姓名       | 性别   |
+------------+--------+
| 申X牟      | 2      |
| 汲X商      | 2      |
| 宫X苏      | 2      |
| 祖X贾      | 2      |
| 皇甫X邴    | 1      |
| 须X上官    | 2      |
| 郗X姜      | 2      |
| 夹谷X贺    | 2      |
| 张X仲孙    | 1      |
| 暨X梁丘    | 1      |
+------------+--------+
10 rows in set (0.00 sec)
```

#### 条件查询
```sql
select 姓名,
CASE 性别 
WHEN '男' THEN '1' 
WHEN '女' THEN '2' 
ELSE '3' END 
AS 性别 
from 学生信息表 
where 性别 = '1'
limit 10;

+------------+--------+
| 姓名       | 性别   |
+------------+--------+
| 皇甫X邴    | 1      |
| 张X仲孙    | 1      |
| 暨X梁丘    | 1      |
| 毕X侯      | 1      |
| 蔺X宇文    | 1      |
| 盖X姚      | 1      |
| 霍X西门    | 1      |
| 雷X涂      | 1      |
| 严X洪      | 1      |
| 蓟X暴      | 1      |
+------------+--------+
10 rows in set (0.00 sec)
```

```sql
mysql> select 姓名,
    -> CASE 性别
    -> WHEN '男' THEN '1'
    -> WHEN '女' THEN '2'
    -> ELSE '3' END
    -> AS 性别2
    -> from 学生信息表
    -> where 性别2 = '1'
    -> limit 10;

ERROR 1054 (42S22): Unknown column '性别2' in 'where clause'
```
#### between and
毕业学校代码0-100
```sql
select * from 学生信息表 where 毕业学校 between 10 and 20 limit 10;

mysql> select * from 学生信息表 where 毕业学校 between 10 and 20 limit 10;
+----------+------------+--------+---------------------+--------------+--------+--------------+
| 学号     | 姓名       | 性别   | 出生日期            | 政治面貌     | 班级   | 毕业学校     |
+----------+------------+--------+---------------------+--------------+--------+--------------+
| 19980101 | 申X牟      | 女     | 1998-05-01 00:00:00 | 团员         | 9801   | 10           |
| 19980106 | 须X上官    | 女     | 1998-02-17 00:00:00 | 团员         | 9801   | 20           |
| 19980108 | 夹谷X贺    | 女     | 1998-12-01 00:00:00 | 团员         | 9801   | 17           |
| 19980139 | 苗X芮      | 女     | 1998-02-24 00:00:00 | 群众         | 9801   | 16           |
| 19980204 | 寿X乐正    | 男     | 1998-11-20 00:00:00 | 群众         | 9802   | 14           |
| 19980206 | 姬X范      | 女     | 1998-06-18 00:00:00 | 团员         | 9802   | 16           |
| 19980245 | 印X林      | 男     | 1998-10-01 00:00:00 | 党员         | 9802   | 16           |
| 19981103 | 闻人X伯    | 女     | 1998-04-06 00:00:00 | 党员         | 9811   | 18           |
| 19981109 | 费X冷      | 男     | 1998-08-01 00:00:00 | 群众         | 9811   | 17           |
| 19981128 | 伏X梅      | 女     | 1998-12-01 00:00:00 | 团员         | 9811   | 20           |
+----------+------------+--------+---------------------+--------------+--------+--------------+
10 rows in set (0.00 sec)
```

#### is null
寻找空值 使用where '栏' is (not) null
```sql
select 学号,姓名,班级 from 学生信息表
where 毕业学校 is null
limit 10;

mysql> select 学号,姓名,班级 from 学生信息表
    -> where 毕业学校 is null
    -> limit 10;
+----------+------------+--------+
| 学号     | 姓名       | 班级   |
+----------+------------+--------+
| 19980110 | 暨X梁丘    | 9801   |
| 19980223 | 夔X鲁      | 9802   |
| 19981119 | 禹X曾      | 9811   |
| 19981211 | 潘X阴      | 9812   |
| 19981217 | 许X双      | 9812   |
| 19983213 | 上官X雷    | 9832   |
| 19983222 | 周X房      | 9832   |
| 19983246 | 戎X欧阳    | 9832   |
| 19984232 | 墨X花      | 9842   |
| 19985125 | 卢X经      | 9851   |
+----------+------------+--------+
10 rows in set (0.00 sec)
```

#### in 与 not in

```sql
select 学号,姓名,班级,毕业学校 from 学生信息表
where 毕业学校 in (10,20)
limit 10;

mysql> select 学号,姓名,班级,毕业学校 from 学生信息表
    -> where 毕业学校 in (10,20)
    -> limit 10;
+----------+------------+--------+--------------+
| 学号     | 姓名       | 班级   | 毕业学校     |
+----------+------------+--------+--------------+
| 19980101 | 申X牟      | 9801   | 10           |
| 19980106 | 须X上官    | 9801   | 20           |
| 19981128 | 伏X梅      | 9811   | 20           |
| 19981133 | 康X韩      | 9811   | 10           |
| 19981139 | 长孙X邵    | 9811   | 20           |
| 19982218 | 干X谯      | 9822   | 20           |
| 19983241 | 曹X莘      | 9832   | 20           |
| 19983244 | 拓跋X容    | 9832   | 10           |
| 19984145 | 安X慕      | 9841   | 10           |
| 19984250 | 冉X席      | 9842   | 10           |
+----------+------------+--------+--------------+
10 rows in set (0.00 sec)
```
#### 模糊查询like
%:任意多个字符
_:任意单个字符
使用“/”转意

一定得加引号
```sql
select 学号,姓名,班级 from 学生信息表 where 姓名 like '%曹%' limit 10;


mysql> select 学号,姓名,班级 from 学生信息表 where 姓名 like '%曹%' limit 10;
+----------+---------+------+
| 学号     | 姓名    | 班级 |
+----------+---------+------+
| 19983114 | 张X曹   | 9831 |
| 19983241 | 曹X莘   | 9832 |
| 19985139 | 曹X于   | 9851 |
| 19985229 | 曹X华   | 9852 |
| 19987221 | 曹X空   | 9872 |
| 19991237 | 伏X曹   | 9912 |
| 19993243 | 有X曹   | 9932 |
| 19996235 | 曹X鲜于 | 9962 |
| 20002105 | 贡X曹   | 0021 |
| 20002134 | 曹X乜   | 0021 |
+----------+---------+------+
10 rows in set (0.00 sec)

select 学号,姓名,班级 from 学生信息表 where 姓名 like '曹%' limit 10;

mysql> select 学号,姓名,班级 from 学生信息表 where 姓名 like '曹%' limit 10;
+----------+---------+------+
| 学号     | 姓名    | 班级 |
+----------+---------+------+
| 19983241 | 曹X莘   | 9832 |
| 19985139 | 曹X于   | 9851 |
| 19985229 | 曹X华   | 9852 |
| 19987221 | 曹X空   | 9872 |
| 19996235 | 曹X鲜于 | 9962 |
| 20002134 | 曹X乜   | 0021 |
| 20005131 | 曹X查   | 0051 |
| 20014109 | 曹X夏侯 | 0141 |
| 20015217 | 曹X曹   | 0152 |
+----------+---------+------+
9 rows in set (0.10 sec)
```
#### 排序
order by "字段名2" asc/desc,"字段名2" asc/desc,

```sql
select 学号,姓名,出生日期 from 学生信息表 order by 出生日期 limit 10;

mysql> select 学号,姓名,出生日期 from 学生信息表 order by 出生日期 limit 10;
+----------+---------+---------------------+
| 学号     | 姓名    | 出生日期            |
+----------+---------+---------------------+
| 19980247 | 索X东郭 | 1998-01-01 00:00:00 |
| 19980133 | 万X吴   | 1998-01-01 00:00:00 |
| 19980231 | 仇X殳   | 1998-01-01 00:00:00 |
| 19980223 | 夔X鲁   | 1998-01-01 00:00:00 |
| 19980212 | 邹X居   | 1998-01-01 00:00:00 |
| 19980229 | 哈X温   | 1998-01-01 00:00:00 |
| 19980238 | 羊X曲   | 1998-01-01 00:00:00 |
| 19981207 | 索X孔   | 1998-01-01 00:00:00 |
| 19980235 | 郁X伏   | 1998-01-01 00:00:00 |
| 19980117 | 成X昝   | 1998-01-01 00:00:00 |
+----------+---------+---------------------+
10 rows in set (0.00 sec)
```

#### 分组函数
| - | - |
| - | - |
|count| 计数|
|sum| 求和|
|avg| 均值|
|max| 最大|
|min| 最小|
所有分组函数都是对某一组函数进行操作

```sql
select count(姓名) from 学生信息表;

mysql> select count(姓名) from 学生信息表;
+-------------+
| count(姓名) |
+-------------+
|        4000 |
+-------------+
1 row in set (0.00 sec)

```

```sql
select avg(成绩) from 学生选课信息表;

mysql> select avg(成绩) from 学生选课信息表;
+-----------+
| avg(成绩) |
+-----------+
|    75.726 |
+-----------+
1 row in set (0.12 sec)

select 学号,成绩 
from 学生选课信息表
where 成绩 > avg(成绩);

mysql> select 学号,avg(成绩)
    -> from 学生选课信息表
    -> where 成绩 > avg(成绩);
ERROR 1111 (HY000): Invalid use of group function
```
原因是where后需要写新的语句
```sql
select 学号,成绩 
from 学生选课信息表
where 成绩 > 
(select avg(成绩) from 学生选课信息表)
limit 10;


mysql> select 学号,成绩
    -> from 学生选课信息表
    -> where 成绩 >
    -> (select avg(成绩) from 学生选课信息表)
    -> limit 10;
+----------+------+
| 学号     | 成绩 |
+----------+------+
| 19982103 |   82 |
| 19981205 |   80 |
| 19989111 |   79 |
| 19984211 |   80 |
| 19982220 |   92 |
| 19988203 |   91 |
| 19988204 |   88 |
| 19988108 |   90 |
| 19989115 |   87 |
| 19984219 |   86 |
+----------+------+
10 rows in set (0.00 sec)

```
#### 单行处理函数
#### ifnull 对空值得处理
```sql
select 学号,姓名,班级,ifnull(毕业学校,'自学') 
from 学生信息表
limit 10;

mysql> select 学号,姓名,班级,ifnull(毕业学校,'自学')
    -> from 学生信息表
    -> limit 10;
+----------+---------+------+-------------------------+
| 学号     | 姓名    | 班级 | ifnull(毕业学校,'自学') |
+----------+---------+------+-------------------------+
| 19980101 | 申X牟   | 9801 | 10                      |
| 19980102 | 汲X商   | 9801 | 66                      |
| 19980103 | 宫X苏   | 9801 | 83                      |
| 19980104 | 祖X贾   | 9801 | 66                      |
| 19980105 | 皇甫X邴 | 9801 | 50                      |
| 19980106 | 须X上官 | 9801 | 20                      |
| 19980107 | 郗X姜   | 9801 | 39                      |
| 19980108 | 夹谷X贺 | 9801 | 17                      |
| 19980109 | 张X仲孙 | 9801 | 48                      |
| 19980110 | 暨X梁丘 | 9801 | 自学                    |
+----------+---------+------+-------------------------+
10 rows in set (0.00 sec)
```

#### group by 和 having
group by：按某些字段分组
having：对分组后得数据过滤
找出每门课最高分数
```sql
select
    ...
from 
    ...
where
    ...
group by 
    ...
having
    ...
order by
    ...
limit
    ...;
```

分组函数一定在group by之后执行
having 后面才执行分组函数 
```sql
select 学号,课程编号,max(成绩) 
from 学生选课信息表
group by 课程编号
limit 10;

mysql> select 学号,课程编号,max(成绩)
    -> from 学生选课信息表
    -> group by 课程编号
    -> limit 10;
+----------+----------+-----------+
| 学号     | 课程编号 | max(成绩) |
+----------+----------+-----------+
| 19982103 | D1-1     |       100 |
| 19981205 | C2-1     |       100 |
| 19989111 | D14-2    |       100 |
| 19989101 | E6-1     |       100 |
| 19989113 | C6-2     |        97 |
| 19984211 | C4-2     |       100 |
| 19981219 | A12-1    |        99 |
| 19983203 | E7-2     |        96 |
| 19982220 | A19-1    |        99 |
| 19988203 | C9-1     |       100 |
+----------+----------+-----------+
10 rows in set (0.01 sec)
```

#### 多字段分组查询

```sql
mysql>  select 系别 from 教师信息表 group by 系别;
+------+
| 系别 |
+------+
| 信院 |
| 能源 |
| 语言 |
| 管院 |
| 理学 |
| 海洋 |
| 材料 |
| 计院 |
| 海工 |
| 车辆 |
+------+
10 rows in set (0.33 sec)

select 系别,count(系别) from 教师信息表 group by 系别;

+------+-------------+
| 系别 | count(系别) |
+------+-------------+
| 信院 |         206 |
| 能源 |         193 |
| 语言 |         194 |
| 管院 |         219 |
| 理学 |         187 |
| 海洋 |         192 |
| 材料 |         218 |
| 计院 |         199 |
| 海工 |         205 |
| 车辆 |         186 |
+------+-------------+
```

不同班级，不同身份最小年龄
就好像每个学校，每个班，每个组的最高分都列出来，进行比较一样，没什么难的。
```sql
select 班级,政治面貌,max(出生日期) 
from 学生信息表 
group by 班级,政治面貌
order by 班级,政治面貌
limit 10;

mysql> select 班级,政治面貌,max(出生日期)
    -> from 学生信息表
    -> group by 班级,政治面貌
    -> order by 班级,政治面貌
    -> limit 10;
+------+----------+---------------------+
| 班级 | 政治面貌 | max(出生日期)       |
+------+----------+---------------------+
| 0001 | 党员     | 2000-12-01 00:00:00 |
| 0001 | 团员     | 2000-12-01 00:00:00 |
| 0001 | 群众     | 2000-12-01 00:00:00 |

| 0002 | 党员     | 2000-12-01 00:00:00 |
| 0002 | 团员     | 2000-12-01 00:00:00 |
| 0002 | 群众     | 2000-12-01 00:00:00 |

| 0011 | 党员     | 2000-12-01 00:00:00 |
| 0011 | 团员     | 2000-12-01 00:00:00 |
| 0011 | 群众     | 2000-09-18 00:00:00 |

| 0012 | 党员     | 2000-11-19 00:00:00 |
+------+----------+---------------------+
10 rows in set (0.00 sec)
```
